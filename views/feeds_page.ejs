<%- include partials/head.ejs -%>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/emoji-picker/1.1.5/css/emoji.css" rel="stylesheet">
<link rel="stylesheet" href="http://ichord.github.io/At.js/dist/css/jquery.atwho.css" />
</head>

<body>

    <div class="container-fluid mh-100 main-container">
        <div class="row">
            <!-- ----------------Left Column -->
            <%- include partials/sidemenu.ejs %>
            <!-- ----------------END Left Column -->


            <!-- ----------------Middle Column -->
            <div class="col-md-6 middle-column">

                <div class="row">
                    <div class="col-md-12 custom-border custom-border-bottom py-3">
                        <h5>HOME</h5>
                    </div>
                    <div class="col-md-12 custom-border middle-upper-layer py-3">

                        <form method="POST" action="/feedPost" enctype="multipart/form-data">
                            <div class="form-group mb-0">

                                <div class="row">
                                    <div class="col-md-1">
                                        <!-- <img src="<%= posts[0].image_src %>" class="rounded-circle mr-3" height="60px"
                                            width="60px" /> -->
                                        <img src="<%= user.profile_pic %>" class="rounded-circle mr-3" height="60px"
                                            width="60px" />
                                    </div>


                                    <input type="file" name="post-image" id="main-post-image" style="display: none;"
                                        accept="image/x-png,image/gif,image/jpeg" />

                                    <div class=" col-md-11">
                                        <p class="lead emoji-picker-container feeds mb-2">
                                            <textarea
                                                class="form-control textarea-control input-type-dec post-text-area"
                                                maxlength="280" rows="3" column=10 id="body" name="body"
                                                placeholder="What's on your mind?" data-emojiable="true" maxlength="280"
                                                data-emoji-input="unicode"></textarea>
                                        </p>
                                    </div>
                                    <div class="col-md-12 mt-2 controls">
                                        <div class="image-upload">
                                            <!-- <i class="fa fa-picture-o" aria-hidden="true"></i> -->
                                            <svg viewBox="0 0 24 24" class="icon">
                                                <g>
                                                    <path
                                                        d="M19.75 2H4.25C3.01 2 2 3.01 2 4.25v15.5C2 20.99 3.01 22 4.25 22h15.5c1.24 0 2.25-1.01 2.25-2.25V4.25C22 3.01 20.99 2 19.75 2zM4.25 3.5h15.5c.413 0 .75.337.75.75v9.676l-3.858-3.858c-.14-.14-.33-.22-.53-.22h-.003c-.2 0-.393.08-.532.224l-4.317 4.384-1.813-1.806c-.14-.14-.33-.22-.53-.22-.193-.03-.395.08-.535.227L3.5 17.642V4.25c0-.413.337-.75.75-.75zm-.744 16.28l5.418-5.534 6.282 6.254H4.25c-.402 0-.727-.322-.744-.72zm16.244.72h-2.42l-5.007-4.987 3.792-3.85 4.385 4.384v3.703c0 .413-.337.75-.75.75z">
                                                    </path>
                                                    <circle cx="8.868" cy="8.309" r="1.542"></circle>
                                                </g>
                                            </svg>
                                        </div>
                                        <button class="btn btn-primary post-btn btn-sm float-bottom"
                                            style="margin-top: -1px; margin-right: 20px;" type="submit"
                                            value="Post">Tweet</button>
                                        <input class="receiver float-right mr-2 mt-0" type="hidden" name="receiver"
                                            id="receiver" placeholder="Receiver's ID">
                                    </div>
                                    <div class="image-previews">
                                        <div class="image-wrapper">
                                            <span class="image-pre">
                                                <span class="img-close"><i class="fa fa-times-circle"
                                                        aria-hidden="true"></i></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- <div class="image-previews">
                        <div class="image-wrapper">
                            <span class="image-pre">
                                <span class="img-close"><i class="fa fa-times-circle" aria-hidden="true"></i></span>
                            </span>
                        </div>
                    </div> -->

                    <div class="col-md-12 all-posts custom-border">
                        <% if (posts.length > 1) { %>
                        <% for(var curPost=1; curPost<posts.length; curPost++) { %>

                        <div class="table-container">

                            <table class="post-table">
                                <!-- <% if(posts[curPost].author == posts[curPost].receiver && posts[curPost].author == posts[0].username) { %>
                            <tr class="post-row">
                                <td class="post-content">
                                    <b><%= "My Feed!" %></b>
                                </td>
                            </tr>
                            <%}%>
                                 -->


                                <% if(
                                    posts[curPost].visible_to && 
                                    posts[curPost].visible_to.userActivity && 
                                    posts[curPost].visible_to.users.length >0 && posts[curPost].visible_to.users.find(u=> JSON.stringify(u) == JSON.stringify(user.user_id)) &&
                                    (JSON.stringify(user.user_id) != JSON.stringify(posts[curPost].user_id.user_id))
                                    && !user.group_id.some(r=> posts[curPost].user_id.group_id.indexOf(r) >= 0)
                                ) { %>
                                <div class="feedNotification">
                                    <p>
                                        <%= posts[curPost].visible_to.userId.username %> has
                                        <%= posts[curPost].visible_to.userActivity == 'love' ? "liked this " : "commented on" %>
                                        post</p>
                                </div>
                                <% } %>

                                <% if(posts[curPost].author == posts[curPost].receiver) { %>

                                <tr class="post-row">
                                    <td class="post-content">

                                        <% if(posts[curPost].post_type == "retweet" || posts[curPost].post_type == "quote") { %>

                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="row">
                                                    <div class="col-md-10">
                                                        <img src=<%= posts[curPost].user_id.profile_pic %>
                                                            class="rounded-circle mr-3" height="25px" width="25px" />
                                                        <!-- <b>@<%= posts[curPost].user_id.username %> Feed:</b> -->
                                                        <b>@<%= posts[curPost].user_id.username %></b>
                                                        <!-- <span class="tag_username">-
                                                            @<%= posts[curPost].user_id.username %></span> -->
                                                    </div>
                                                    <div class="col-md-2 postTimestamp">
                                                        <%= moment(posts[curPost].created_at).fromNow(true) %> ago
                                                    </div>
                                                </div>

                                            </div>

                                            <% if(posts[curPost].post_type == "quote") { %>
                                            <div class="col-md-12 p-2">
                                                <div class="comment-background pl-4">
                                                    <%- posts[curPost].body %>
                                                </div>
                                            </div>
                                            <% } %>

                                            <div class="col-md-12" style="padding-left: 30px; margin-top: 14px;">
                                                <img src=<%= posts[curPost].parent_id.user_id.profile_pic %>
                                                    class="rounded-circle mr-3" height="25px" width="25px" />
                                                <!-- <b>@<%= posts[curPost].parent_id.user_id.username %>'s Feed:</b> -->
                                                <b>@<%= posts[curPost].parent_id.user_id.username %></b>
                                                <!-- <span class="tag_username">-
                                                    @<%= posts[curPost].parent_id.user_id.username %></span> -->

                                            </div>



                                        </div>

                                        <% } else { %>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="row">
                                                    <div class="col-md-10">
                                                        <% if(posts[curPost].user_id && posts[curPost].user_id.profile_pic) { %>
                                                        <img src="<%= posts[curPost].user_id.profile_pic %>"
                                                            class="rounded-circle mr-3" height="25px" width="25px" />
                                                        <% } %>

                                                        <% if(posts[curPost].user_id && posts[curPost].user_id.name) { %>
                                                        <b>@<%= posts[curPost].user_id.username %></b>
                                                        <% } %>
                                                        <span class="tag_username">
                                                            <!-- -
                                                            <% if(posts[curPost].user_id && posts[curPost].user_id.username) { %>
                                                            @<%= posts[curPost].user_id.username %> -->
                                                        </span>
                                                        <% } %>
                                                    </div>
                                                    <div class="col-md-2 postTimestamp">
                                                        <%= moment(posts[curPost].created_at).fromNow(true) %> ago
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <% } %>
                                    </td>
                                </tr>


                                <%}%>
                                        
                            <% if(posts[curPost].author != posts[curPost].receiver) { %>

                                <tr class="post-row">
                                    <td class="post-content">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="row">
                                                    <div class="col-md-10">
                                                        <img src=<%= posts[curPost].user_id.profile_pic %>
                                                            class="rounded-circle mr-3" height="25px" width="25px" />
                                                        <!-- <b>@<%= posts[curPost].author %> Feed:</b> -->
                                                        <b>@<%= posts[curPost].user_id.username %></b>
                                                        <!-- <span class="tag_username">-
                                                            @<%= posts[curPost].user_id.username %></span> -->
                                                    </div>
                                                    <div class="col-md-2 postTimestamp">
                                                        <%= moment(posts[curPost].created_at).fromNow(true) %> ago
                                                    </div>
                                                </div>
                                            </div>

                                            <% if(posts[curPost].retweet_edit_body != "") { %>

                                            <div class="col-md-12 ml-4">
                                                <div class="comment-background pl-4">
                                                    <%- posts[curPost].retweet_edit_body %>
                                                </div>
                                            </div>

                                            <% } %>

                                            <% if(posts[curPost].receiver_id) { %>
                                            <div class="col-md-12 mt-2 ml-5">
                                                <img src=<%= posts[curPost].receiver_image %>
                                                    class="rounded-circle mr-3" height="25px" width="25px" />

                                                <b>@<%= posts[curPost].receiver_id.username %></b>
                                                <!-- <span class="tag_username">-
                                                    @<%= posts[curPost].receiver_id.username %></span> -->
                                            </div>
                                            <% } %>

                                        </div>

                                    </td>
                                </tr>
                                <% } %>

                                <tr class="post-row">
                                    <td class="post-content">
                                        <div class="row">
                                            <div class="col-md-12 p-1">

                                                <% if(posts[curPost].author != posts[curPost].receiver) { %>
                                                <div class="comment-background" style="margin-left:58px;">
                                                    <%- posts[curPost].body %>

                                                </div>

                                                <% } else {%>
                                                <div class="comment-background" style="margin-left:58px;">

                                                    <% if(posts[curPost].post_type == "tweet") { %>
                                                    <p><%- posts[curPost].body %></p>

                                                    <% if(posts[curPost].image !="null") { %>
                                                    <div class="post-img-wrapper">
                                                        <span class="post-image" id="pst-image" data-toggle="modal"
                                                            data-target="#postImageModal"
                                                            onclick="previewPostImage(this)"
                                                            style="background-image: url('<%= posts[curPost].image %>')"></span>
                                                    </div>
                                                    <% } %>

                                                    <% } else { %>

                                                    <% if(posts[curPost].parent_id && posts[curPost].parent_id.body) { %>
                                                    <p><%- posts[curPost].parent_id.body %></p>
                                                    <% } %>

                                                    <% if( posts[curPost].parent_id && posts[curPost].parent_id.image != "null") { %>
                                                    <div class="post-img-wrapper">
                                                        <span class="post-image" id="pst-image" data-toggle="modal"
                                                            data-target="#postImageModal"
                                                            onclick="previewPostImage(this)"
                                                            style="background-image: url('<%= posts[curPost].parent_id.image %>')"></span>
                                                    </div>
                                                    <% } %>

                                                    <% } %>
                                                </div>
                                                <% } %>
                                            </div>
                                            <div class="col-md-12">

                                                <% var a = "/feedPost?feedId=".concat(posts[curPost]._id) %>
                                                <form method="POST" action="<%= a %>" enctype="multipart/form-data">

                                                    <% 
                                                    const map1 = new Map();
                                                    if(map1.has(posts[curPost].feedId)){%>
                                                    <li class="active" style="list-style: none;">
                                                        <!-- <button class="custom-padding" name="like" id="like" type="submit"
                                                value="Post">
                                                <i class="glyphicon glyphicon-thumbs-up" style="color:blue"></i>
                                                liked</a></button> -->

                                                        <%}
                                                    else
                                                    {
                                                    %>
                                                    <li class="active" style="list-style: none;">
                                                        <!-- <button class="custom-padding" name="like" id="like" type="submit"
                                                value="Post"><i class="glyphicon glyphicon-thumbs-up "></i>
                                                like</a></button> -->
                                                        <%	}
                                                    %>
                                                        <input type="hidden" name="body" id="body"
                                                            value="<%=posts[curPost].body%>">
                                                        <input type="hidden" name="count" id="count"
                                                            value="<%=posts[curPost].retweetcount%>">
                                                        <input class="receiver" type="hidden" name="receiver"
                                                            id="receiver" value="<%=posts[curPost].receiver%>">


                                                        <div class="row">


                                                            <div class="col-md-3 text-center">
                                                                <button class="custom-padding tweet-buttons"
                                                                    name="comment-btn" data-toggle="modal" title="Reply"
                                                                    data-target=#m<%= posts[curPost]._id %>
                                                                    type="button">
                                                                    <div class="comment-icon">
                                                                        <i class="fa fa-comment" aria-hidden="true"></i>

                                                                        <% if(posts[curPost].parent_id && posts[curPost].post_type == "retweet") { %>
                                                                        <%= posts[curPost].parent_id && posts[curPost].parent_id.reply_count %>
                                                                        <% } else { %>
                                                                        <%= posts[curPost].reply_count %>
                                                                        <% } %>

                                                                    </div>
                                                                </button>

                                                                <!-- Modal -->
                                                                <div class="modal" id=m<%= posts[curPost]._id %>
                                                                    tabindex="-1" role="dialog"
                                                                    aria-labelledby="exampleModalLabel"
                                                                    aria-hidden="true">
                                                                    <div class="modal-dialog" role="document">
                                                                        <div class="modal-content">
                                                                            <div class="modal-header">
                                                                                <h5 class="modal-title"
                                                                                    id="exampleModalLabel">
                                                                                    Type Comment</h5>
                                                                                <button type="button" class="close"
                                                                                    data-dismiss="modal"
                                                                                    aria-label="Close">
                                                                                    <span
                                                                                        aria-hidden="true">&times;</span>
                                                                                </button>
                                                                            </div>
                                                                            <div class="modal-body comment-modal">
                                                                                <div
                                                                                    class="lead emoji-picker-container comment-container">
                                                                                    <textarea
                                                                                        class="input-type-dec1 form-control textarea-control"
                                                                                        type="text" rows="3"
                                                                                        id="comment" name="comment"
                                                                                        placeholder="Comment"
                                                                                        data-emojiable="true"
                                                                                        maxlength="280"
                                                                                        data-emoji-input="unicode"></textarea>
                                                                                    <input type="file"
                                                                                        id="comment-post-image"
                                                                                        class="file<%= posts[curPost]._id %>"
                                                                                        style="display: none;"
                                                                                        name="post-image" />
                                                                                    <div class="comment-controls">
                                                                                        <svg viewBox="0 0 24 24"
                                                                                            id="trigger#<%= posts[curPost]._id %>"
                                                                                            class="icon comment-image">
                                                                                            <g>
                                                                                                <path
                                                                                                    d="M19.75 2H4.25C3.01 2 2 3.01 2 4.25v15.5C2 20.99 3.01 22 4.25 22h15.5c1.24 0 2.25-1.01 2.25-2.25V4.25C22 3.01 20.99 2 19.75 2zM4.25 3.5h15.5c.413 0 .75.337.75.75v9.676l-3.858-3.858c-.14-.14-.33-.22-.53-.22h-.003c-.2 0-.393.08-.532.224l-4.317 4.384-1.813-1.806c-.14-.14-.33-.22-.53-.22-.193-.03-.395.08-.535.227L3.5 17.642V4.25c0-.413.337-.75.75-.75zm-.744 16.28l5.418-5.534 6.282 6.254H4.25c-.402 0-.727-.322-.744-.72zm16.244.72h-2.42l-5.007-4.987 3.792-3.85 4.385 4.384v3.703c0 .413-.337.75-.75.75z">
                                                                                                </path>
                                                                                                <circle cx="8.868"
                                                                                                    cy="8.309"
                                                                                                    r="1.542">
                                                                                                </circle>
                                                                                            </g>
                                                                                        </svg>
                                                                                        <button
                                                                                            class="btn-comment btn-sm"
                                                                                            type="submit">Comment</button>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="image-preview">
                                                                                    <div style="display: none;"
                                                                                        class="comment-post-image-close-wrapper">
                                                                                        <span class="img-close"><i
                                                                                                class="fa fa-times-circle"
                                                                                                aria-hidden="true"></i></span>
                                                                                        <img id="comment-image-preview"
                                                                                            alt="Image"
                                                                                            class="commentImage<%= posts[curPost]._id %>"
                                                                                            draggable="true">
                                                                                    </div>
                                                                                </div>
                                                                                <br>

                                                                            </div>
                                                                            <div class="modal-footer">
                                                                                <button type="button"
                                                                                    class="btn btn-secondary"
                                                                                    data-dismiss="modal">Close</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-3 text-center ">
                                                                <div class="btn-group dropleft">
                                                                    <button
                                                                        class="custom-padding tweet-buttons dropright"
                                                                        name="edit" data-toggle="dropdown"
                                                                        title="Retweet/Retweet with comment"
                                                                        id="openmodal<%= posts[curPost]._id %>"
                                                                        data-toggle="dropdown" aria-haspopup="true"
                                                                        aria-expanded="false" type="button">
                                                                        <div class="edit-icon">
                                                                            <i class="fa fa-retweet"
                                                                                aria-hidden="true"></i></a>
                                                                        </div>
                                                                    </button>
                                                                    <div class="dropdown-menu">
                                                                        <a class="dropdown-item" href="#"
                                                                            style="padding: 0;">
                                                                            <button class="custom-padding tweet-buttons"
                                                                                name="retweet" id="retweet"
                                                                                type="submit" value="Post"
                                                                                title="Retweet" style="width: 100%;">

                                                                                <div class="retweet-icon"
                                                                                    style="padding: 0; background-color: transparent;">
                                                                                    <i class="fa fa-retweet"
                                                                                        aria-hidden="true"></i>
                                                                                    <!-- <%= posts[curPost].retweet_count %> -->

                                                                                    <% if(posts[curPost].parent_id && posts[curPost].post_type == "retweet") { %>
                                                                                    <%= posts[curPost].parent_id && posts[curPost].parent_id.retweet_count %>
                                                                                    <% } else { %>
                                                                                    <%= posts[curPost].retweet_count %>
                                                                                    <% } %>
                                                                                </div>


                                                                            </button>
                                                                        </a>
                                                                        <a class="dropdown-item" href="#">
                                                                            <button class="custom-padding tweet-buttons"
                                                                                name="edit" data-toggle="modal"
                                                                                title="Retweet with comment"
                                                                                style="width: 100px;"
                                                                                data-target=#edit<%= posts[curPost]._id %>
                                                                                type="button">



                                                                                <div class="edit-icon"
                                                                                    style="padding: 0; background-color: transparent;">
                                                                                    <i class="fa fa-pencil"
                                                                                        aria-hidden="true"></i>
                                                                                    <%= posts[curPost].quote_count %>


                                                                                </div>
                                                                            </button>
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <div class="modal" id=edit<%= posts[curPost]._id %>
                                                                tabindex="-1" role="dialog"
                                                                aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog" role="document">
                                                                    <div class="modal-content">
                                                                        <div class="modal-header">
                                                                            <h5 class="modal-title"
                                                                                id="exampleModalLabel">
                                                                                Type your Tweet
                                                                            </h5>
                                                                            <button type="button" class="close"
                                                                                data-dismiss="modal" aria-label="Close">
                                                                                <span aria-hidden="true">&times;</span>
                                                                            </button>
                                                                        </div>
                                                                        <div class="modal-body">
                                                                            <p class="lead emoji-picker-container">
                                                                                <textarea class="input-type-dec1"
                                                                                    type="text" rows="2" cols="60"
                                                                                    id="retweet_edit_body"
                                                                                    name="retweet_edit_body"
                                                                                    placeholder="Tweet"
                                                                                    data-emojiable="true"
                                                                                    data-emoji-input="unicode"
                                                                                    color:black></textarea>
                                                                            </p>
                                                                            <br>
                                                                            <br>

                                                                            <div class="row">

                                                                                <div class="col-md-12"
                                                                                    style="padding-left: 30px;">

                                                                                    <% if(posts[curPost].author == posts[curPost].receiver) { %>
                                                                                    <img src="<%= posts[curPost].user_id && posts[curPost].user_id.profile_pic %>"
                                                                                        class="rounded-circle mr-3"
                                                                                        height="25px" width="25px" />

                                                                                    <% if(posts[curPost].user_id && posts[curPost].user_id.name) { %>
                                                                                    <b>@<%= posts[curPost].user_id.username %></b>
                                                                                    <% } %>


                                                                                    <span class="tag_username">-
                                                                                        <% if(posts[curPost].user_id && posts[curPost].user_id.username) { %>
                                                                                        <!-- @<%= posts[curPost].user_id.username %></span> -->
                                                                                        <% } %>

                                                                                        <%}%>
                                        
                                                                                                                        <% if(posts[curPost].author != posts[curPost].receiver) { %>

                                                                                        <img src=<%= posts[curPost].author_image %>
                                                                                            class="rounded-circle mr-3"
                                                                                            height="25px"
                                                                                            width="25px" />
                                                                                        <b>@<%= posts[curPost].author %>
                                                                                        </b>



                                                                                        <% } %>

                                                                                </div>

                                                                                <div class="col-md-12">
                                                                                    <div
                                                                                        class="comment-background p-2 pl-3 ml-5">
                                                                                        <span><%- posts[curPost].body %></span>
                                                                                        <br>

                                                                                        <% if(posts[curPost].image !="null"){ %>
                                                                                        <div
                                                                                            class="image-preview post-retweet-preview">
                                                                                            <div style="display: block;"
                                                                                                class="comment-post-image-close-wrapper">
                                                                                                <img id="comment-image-preview"
                                                                                                    alt="Image"
                                                                                                    style="width: 100%;"
                                                                                                    src="<%= posts[curPost].image %>"
                                                                                                    draggable="true">
                                                                                            </div>
                                                                                        </div>
                                                                                        <% } %>



                                                                                    </div>
                                                                                </div>
                                                                            </div>


                                                                            <button class="btn-comment"
                                                                                name="retweet_edit_id"
                                                                                id="retweet_edit_id" type="submit"
                                                                                value=<%= posts[curPost]._id %>>Tweet</button>
                                                                        </div>
                                                                        <div class="modal-footer">
                                                                            <button type="button"
                                                                                class="btn btn-secondary"
                                                                                data-dismiss="modal">Close</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3 text-center">
                                                                <button class="custom-padding tweet-buttons" name="love"
                                                                    title="Like" id="love" type="submit"
                                                                    value=<%= posts[curPost]._id %>>
                                                                    <div class="love-icon">
                                                                        <i class="fa fa-heart-o"
                                                                            aria-hidden="true"></i></a>

                                                                        <% if(posts[curPost].parent_id && posts[curPost].post_type == "retweet") { %>
                                                                        <%= posts[curPost].parent_id && posts[curPost].parent_id.like_count %>
                                                                        <% } else { %>
                                                                        <%= posts[curPost].like_count %>
                                                                        <% } %>

                                                                    </div>
                                                                </button>
                                                            </div>
                                                        </div>
                                                </form>
                                                <!-- <button class="custom-padding" name="dislike" id="dislike" type="submit"
                                                value="Post"><i class="glyphicon glyphicon-thumbs-down"></i>
                                                dislike</a></button> -->
                                                </li>

                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </td>
                                </tr>
                                <!-- <tr class="post-comment">
                                <td class="post-content py-3">
                                    <% var a = "/user/feedPost?feedId=".concat(posts[curPost]._id) %>
                                    <form method="POST" , action=<%= a %>>
                                        <textarea class="input-type-dec1" type="text" rows="2" cols="60" id="comment"
                                            name="comment" placeholder="Comment"></textarea>
                                        <br>
                                        <button class="btn-comment" type="submit" value="Post">Comment</button>
                                    </form>
                                </td>
                            </tr> -->
                                <% if (posts[curPost].comments && posts[curPost].comments.length) { %>
                                <% for(var curComment=0; curComment<posts[curPost].comments.length; curComment++) { %>
                                <tr>
                                    <td>
                                        <table class="post-comment-table">
                                            <tr class="post-comment">
                                                <td class="post-row">
                                                    <div class="pos py-2 px-4">
                                                        <div class="row">
                                                            <div class="col-md-1">
                                                                <img class="rounded-circle mr-3" height="40px"
                                                                    width="40px"
                                                                    src=<%= posts[curPost].comments[curComment].user_id.profile_pic %> />
                                                            </div>
                                                            <div class="col-md-11">
                                                                <!-- <b class="mr-2">@<%= posts[curPost].comments[curComment].author %>
                                                                    :
                                                                </b> -->
                                                                <div class="mr-2">
                                                                    <b>@<%= posts[curPost].comments[curComment].user_id.username %></b>
                                                                    <!-- <span class="tag_username">-
                                                                        @<%= posts[curPost].comments[curComment].user_id.username %></span> -->
                                                                </div>
                                                                <p class="comment-background">
                                                                    <%- posts[curPost].comments[curComment].body %>
                                                                </p>


                                                                <% if(posts[curPost].comments[curComment].image !="null") { %>
                                                                <div
                                                                    class="post-img-wrapper comment-post-image-wrapper">
                                                                    <span class="post-image" id="pst-image"
                                                                        data-toggle="modal"
                                                                        data-target="#postImageModal"
                                                                        onclick="previewPostImage(this)"
                                                                        style="background-image: url('<%= posts[curPost].comments[curComment].image %>')"></span>
                                                                </div>
                                                                <% } %>

                                                                <% var a = "/feedPost?feedId=".concat(posts[curPost].comments[curComment]._id) %>
                                                                <form method="POST" , action=<%= a %>>
                                                                    <input type="hidden" name="body" id="body"
                                                                        value="<%=posts[curPost].comments[curComment].body%>">

                                                                    <input type="hidden" name="post_id" id="post_id"
                                                                        value="<%=posts[curPost].comments[curComment]._id%>">
                                                                    <div class="row">
                                                                        <div class="col-md-4">
                                                                            <button class="custom-padding tweet-buttons"
                                                                                name="comment-btn" data-toggle="modal"
                                                                                type="button" title="Reply"
                                                                                data-target=#m<%= posts[curPost]._id %>>

                                                                                <div class="comment-icon">
                                                                                    <i class="fa fa-comment"
                                                                                        aria-hidden="true"></i>
                                                                                </div>
                                                                            </button>

                                                                            <!-- Modal -->
                                                                            <div class="modal"
                                                                                id=m<%= posts[curPost]._id %>
                                                                                tabindex="-1" role="dialog"
                                                                                aria-labelledby="exampleModalLabel"
                                                                                aria-hidden="true">
                                                                                <div class="modal-dialog"
                                                                                    role="document">
                                                                                    <div class="modal-content">
                                                                                        <div class="modal-header">
                                                                                            <h5 class="modal-title"
                                                                                                id="exampleModalLabel">
                                                                                                Type Comment</h5>
                                                                                            <button type="button"
                                                                                                class="close"
                                                                                                data-dismiss="modal"
                                                                                                aria-label="Close">
                                                                                                <span
                                                                                                    aria-hidden="true">&times;</span>
                                                                                            </button>
                                                                                        </div>
                                                                                        <div class="modal-body">
                                                                                            <textarea
                                                                                                class="input-type-dec1"
                                                                                                type="text" rows="2"
                                                                                                cols="60" id="comment"
                                                                                                name="comment"
                                                                                                placeholder="Comment"
                                                                                                color:black></textarea>
                                                                                            <br>
                                                                                            <button class="btn-comment"
                                                                                                type="submit">Comment</button>
                                                                                        </div>
                                                                                        <div class="modal-footer">
                                                                                            <button type="button"
                                                                                                class="btn btn-secondary"
                                                                                                data-dismiss="modal">Close</button>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <div class="btn-group dropleft">
                                                                                <button
                                                                                    class="custom-padding tweet-buttons dropright"
                                                                                    name="edit" data-toggle="dropdown"
                                                                                    title="Retweet/Retweet with comment"
                                                                                    id=openmodal<%= posts[curPost]._id %>
                                                                                    data-toggle="dropdown"
                                                                                    aria-haspopup="true"
                                                                                    aria-expanded="false" type="button">
                                                                                    <div class="edit-icon">
                                                                                        <i class="fa fa-retweet"
                                                                                            aria-hidden="true"></i></a>
                                                                                    </div>
                                                                                </button>


                                                                                <div class="dropdown-menu">
                                                                                    <a class="dropdown-item" href="#"
                                                                                        style="padding: 0;">
                                                                                        <button
                                                                                            class="custom-padding tweet-buttons"
                                                                                            name="retweet_com"
                                                                                            id="retweet_com"
                                                                                            type="submit"
                                                                                            title="Retweet"
                                                                                            style="width: 100%"
                                                                                            value="<%= posts[curPost].comments[curComment].user_id.username %>">
                                                                                            <div class="retweet-icon">
                                                                                                <i class="fa fa-retweet"
                                                                                                    aria-hidden="true"></i>
                                                                                                <!-- value=<%= posts[curPost].comments[curComment].author %> -->
                                                                                                <%= posts[curPost].comments[curComment].retweet_count %>

                                                                                        </button>
                                                                                    </a>
                                                                                    <a class="dropdown-item" href="#">
                                                                                        <button
                                                                                            class="custom-padding tweet-buttons"
                                                                                            name="edit"
                                                                                            data-toggle="modal"
                                                                                            title="Retweet with comment"
                                                                                            style="width: 100px;"
                                                                                            data-target=#edit<%= posts[curPost].comments[curComment]._id %>
                                                                                            type="button">



                                                                                            <div class="edit-icon"
                                                                                                style="padding: 0; background-color: transparent;">
                                                                                                <i class="fa fa-pencil"
                                                                                                    aria-hidden="true"></i>
                                                                                                <%= posts[curPost].comments[curComment].quote_count %>


                                                                                            </div>
                                                                                        </button>
                                                                                    </a>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <div class="modal"
                                                                            id=edit<%= posts[curPost].comments[curComment]._id %>
                                                                            tabindex="-1" role="dialog"
                                                                            aria-labelledby="exampleModalLabel"
                                                                            aria-hidden="true">
                                                                            <div class="modal-dialog" role="document">
                                                                                <div class="modal-content">
                                                                                    <div class="modal-header">
                                                                                        <h5 class="modal-title"
                                                                                            id="exampleModalLabel">
                                                                                            Type your Tweet
                                                                                        </h5>
                                                                                        <button type="button"
                                                                                            class="close"
                                                                                            data-dismiss="modal"
                                                                                            aria-label="Close">
                                                                                            <span
                                                                                                aria-hidden="true">&times;</span>
                                                                                        </button>
                                                                                    </div>
                                                                                    <div class="modal-body">
                                                                                        <p
                                                                                            class="lead emoji-picker-container">
                                                                                            <textarea
                                                                                                class="input-type-dec1"
                                                                                                type="text" rows="2"
                                                                                                cols="60"
                                                                                                id="retweet_edit_body_comm"
                                                                                                name="retweet_edit_body_comm"
                                                                                                placeholder="Tweet"
                                                                                                data-emojiable="true"
                                                                                                data-emoji-input="unicode"
                                                                                                color:black></textarea>
                                                                                        </p>
                                                                                        <br>
                                                                                        <br>


                                                                                        <div class="row">

                                                                                            <div class="col-md-12"
                                                                                                style="padding-left: 30px;">

                                                                                                <!-- <p><%= JSON.stringify(posts[curPost].comments[curComment].user_id) %>
                                                                                                </p> -->

                                                                                                <img src=<%= posts[curPost].comments[curComment].user_id.profile_pic %>
                                                                                                    class="rounded-circle mr-3"
                                                                                                    height="25px"
                                                                                                    width="25px" />
                                                                                                <!-- <b>@<%= posts[curPost].comments[curComment].author %></b> -->
                                                                                                <b>@<%= posts[curPost].comments[curComment].user_id.username %></b>
                                                                                                <!-- <span
                                                                                                    class="tag_username">-
                                                                                                    @<%= posts[curPost].comments[curComment].user_id.username %></span> -->

                                                                                            </div>

                                                                                            <div class="col-md-12">
                                                                                                <div
                                                                                                    class="comment-background p-2 pl-3 ml-5">
                                                                                                    <%- posts[curPost].comments[curComment].body %>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>


                                                                                        <button class="btn-comment"
                                                                                            name="retweet_edit_id_comm"
                                                                                            id="retweet_edit_id_comm"
                                                                                            type="submit"
                                                                                            value=<%= posts[curPost].comments[curComment]._id %>>Tweet</button>
                                                                                    </div>
                                                                                    <div class="modal-footer">
                                                                                        <button type="button"
                                                                                            class="btn btn-secondary"
                                                                                            data-dismiss="modal">Close</button>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!--hash code-->
                                                                        <div class="col-md-4">
                                                                            <button class="custom-padding tweet-buttons"
                                                                                name="love_com" id="love_com"
                                                                                type="submit" title="Like"
                                                                                value=<%= posts[curPost].comments[curComment]._id %>>
                                                                                <div class="love-icon">
                                                                                    <i class="fa fa-heart-o"
                                                                                        aria-hidden="true"></i></a>
                                                                                    <%= posts[curPost].comments[curComment].like_count %>
                                                                                </div>
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                </form>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <% } %>
                                <% } %>
                            </table>
                        </div>
                        <% }
                    } else { %>
                        <%- include('partials/empty-view.ejs', { "message": "No feeds", "subMessage": "You haven't posted anything yet. Post something to get started", icon: "fa fa-pencil" }) %>
                        <% } %>
                    </div>
                </div>

            </div>
            <!-- ----------------END Middle Column -->

            <!-- ----------------Right Column -->
            <div class="col-md-3 mt-3">
                <div class="col-md-12 right-header">
                    <h4>Connections</h4>
                </div>
                <% if(connections.length != 0){ %>
                <div class="col-md-12">
                    <% for(var i = 0; i < connections.length; i++) { %>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <img class="rounded-circle mr-3" height="25px" width="25px"
                                src="<%= connections[i].profile_pic ? connections[i].profile_pic : 'https://via.placeholder.com/150' %>" />
                            <%= connections[i].username ? connections[i].username: "Unavailable" %>
                        </li>
                    </ul>
                    <% } %>
                </div>
                <% } %>

            </div>
            <!-- ----------------END Right Column -->
        </div>
    </div>

    <!-- Post Image Preview -->
    <div class="modal fade" id="postImageModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div aria-label="Image" class="post-image-full-wrapper">
                        <img alt="Image" draggable="true"
                            src="https://pbs.twimg.com/media/Ean-0rzU4AA6Soz?format=jpg&amp;name=large"
                            class="image-css-9pa8cd">
                    </div>
                </div>
            </div>
        </div>


        <script src="https://cdnjs.cloudflare.com/ajax/libs/emoji-picker/1.1.5/js/config.js"
            integrity="sha256-Njl3ijNQqNX9QZyHkmY7s0kAGGA6RUAj9R6CrnXlfH0=" crossorigin="anonymous"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/emoji-picker/1.1.5/js/util.js"
            integrity="sha256-e8g2hYx3+F2EpHQkgsrqE2bFSRcmCPt9tH2OBkr8O+8=" crossorigin="anonymous"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/emoji-picker/1.1.5/js/emoji-picker.js.map"
            integrity="undefined" crossorigin="anonymous"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/emoji-picker/1.1.5/js/jquery.emojiarea.js"
            integrity="sha256-/bDNB+kJN2OZmomHgEiAQp1yZZQzYWc3cs19/5EbkPo=" crossorigin="anonymous"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/emoji-picker/1.1.5/js/emoji-picker.js"
            integrity="sha256-YQRUwQOwVUyoQTdQQ9dq4o5uoWO5eSEXuj9Yux55cgI=" crossorigin="anonymous"></script>

        <script type="text/javascript" src="http://ichord.github.io/Caret.js/src/jquery.caret.js"></script>

        <script type="text/javascript" src="http://ichord.github.io/At.js/dist/js/jquery.atwho.js"></script>


        <script>
            function previewPostImage(e) {
                let image = $(e).css("backgroundImage");
                $('.image-css-9pa8cd').attr('src', image.split('"')[1]);
            }

            $(function () {
                // Initializes and creates emoji set from sprite sheet
                window.emojiPicker = new EmojiPicker({
                    emojiable_selector: '[data-emojiable=true]',
                    assetsPath: '../assets/lib/img/',
                    popupButtonClasses: 'fa fa-smile-o'
                });
                // Finds all elements with `emojiable_selector` and converts them to rich emoji input fields
                // You may want to delay this step if you have dynamically created input fields that appear later in the loading process
                // It can be called as many times as necessary; previously converted input fields will not be converted again
                window.emojiPicker.discover();
            });
        </script>
        <script>
            // Google Analytics
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-49610253-3', 'auto');
            ga('send', 'pageview');
        </script>
        <script>var connections = `<%= suggestions %>`;</script>
        <script src="./../assets/js/user/feeds.js"></script>




        <%- include partials/end.ejs -%>